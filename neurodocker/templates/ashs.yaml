# Instructions to install Automatic Segmentation of Hippocampal Subfields (ASHS).
#
# Repository: https://github.com/pyushkevich/ashs.git
# Website: https://www.nitrc.org/projects/ashs/

generic:
  binaries:
    urls:
      "1.0.0": "https://www.nitrc.org/frs/download.php/10262/ashs-fastashs-20170915.zip//?i_agree=1&download_now=1"
      # Ubuntu 16.04: 
      "2.0.0": https://www.nitrc.org/frs/download.php/10887/ashs-fastashs_2.0.0_07202018.zip
      # Ubuntu 16.04: works, but some atlases are not working yet
    dependencies:
        apt: libxt6
        yum: libXt
    env:
      PATH: "{{ ashs.install_path }}/ashs-fastashs_beta/bin:$PATH"
      ASHS_ROOT: "{{ ashs.install_path }}/ashs-fastashs_beta"
    instructions: |
      {{ ashs.install_dependencies() }}
      echo "Downloading ashs ..."
      mkdir -p {{ ashs.install_path }}
      curl {{ ashs.curl_opts }} -o /tmp/ashs.zip {{ ashs.binaries_url }}
      unzip /tmp/ashs.zip -d {{ ashs.install_path }}
      {% if ashs.version == "1.0.0" -%}
      echo "Downloading atlas compatible with version 1.0.0 ..."
      mkdir /ashs_atlas_upennpmc_20170810
      curl {{ ashs.curl_opts }} http://ashs.projects.nitrc.org/atlas_upennpmc/ashs_atlas_upennpmc_20170810.tar \
            | tar -xz -C /ashs_atlas_upennpmc_20170810 --strip-components 1 
      {% endif -%}
      {% if ashs.version == "2.0.0" -%}
      echo "Downloading atlas compatible with version 2.0.0 ..."
      mkdir /ashs_atlas_magdeburg_7t_20180416
      curl {{ ashs.curl_opts }} http://ashs.projects.nitrc.org/atlas_magdeburg/ashs_atlas_magdeburg_7t_20180416.tgz \
            | tar -xz -C /ashs_atlas_magdeburg_7t_20180416 --strip-components 1 
      {% endif -%}